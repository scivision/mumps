runs:
  using: "composite"

  steps:

  - name: Install prereqs (Linux)
    shell: bash
    if: runner.os == 'Linux'
    run: |
      sudo apt update
      sudo apt install --no-install-recommends liblapack-dev

  - name: install open-mpi (linux)
    shell: bash
    if: ${{ runner.os == 'Linux' && !matrix.mpich }}
    run: sudo apt install --no-install-recommends libopenmpi-dev openmpi-bin libscalapack-openmpi-dev

  - name: install MPICH (linux)
    shell: bash
    if: ${{ runner.os == 'Linux' && matrix.mpich }}
    run: sudo apt install --no-install-recommends libmpich-dev mpich
# libscalapack-mpich-dev is broken, it pulls in openmpi-bin, which leads to OpenMPI clashing with MPICH
# https://packages.ubuntu.com/noble/libscalapack-mpich2.2

  - name: install Scotch (Linux)
    shell: bash
    if: ${{ runner.os == 'Linux' && matrix.scotch}}
    run: |
      sudo apt install --no-install-recommends libptscotch-dev

  - name: install METIS (Linux)
    shell: bash
    if: ${{ runner.os == 'Linux' && matrix.metis }}
    run: sudo apt install --no-install-recommends libmetis-dev

  - name: Install ParMETIS (Linux)
    shell: bash
    if: ${{ runner.os == 'Linux' && matrix.parmetis }}
    run: sudo apt install --no-install-recommends libparmetis-dev

  - name: Install MPI (macOS)
    shell: bash
    if: runner.os == 'macOS'
    run: brew install open-mpi scalapack

  - name: install Scotch (macOS)
    shell: bash
    if: ${{ runner.os == 'macOS' && matrix.scotch }}
    run: |
      brew install scotch
    # Homebrew "scotch" is also ptscotch

  - name: install METIS (macOS)
    shell: bash
    if: ${{ runner.os == 'macOS' && matrix.metis }}
    run: brew install metis

  - name: Install OpenBLAS (Linux)
    shell: bash
    if: ${{ runner.os == 'Linux' && matrix.lapack_vendor == 'OpenBLAS' }}
    run: sudo apt install --no-install-recommends libopenblas-dev
